<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Envio de Emails - Blazee</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body { 
            font-family: 'Inter', sans-serif;
            background: #000000;
            color: #ffffff;
        }
        [v-cloak] { display: none; }
        .card {
            background: #111111;
            border: 1px solid #222222;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.5);
            transition: all 0.3s ease;
        }
        .card:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0, 0, 0, 0.7);
        }
        .gradient-border {
            position: relative;
            border-radius: 0.5rem;
            padding: 1px;
            background: linear-gradient(45deg, #333333, #222222);
        }
        .gradient-border::after {
            content: '';
            position: absolute;
            inset: 0;
            border-radius: 0.5rem;
            padding: 1px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
            -webkit-mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            mask: linear-gradient(#fff 0 0) content-box, linear-gradient(#fff 0 0);
            -webkit-mask-composite: xor;
            mask-composite: exclude;
        }
        input, select {
            background: #1a1a1a !important;
            border-color: #333333 !important;
            color: #ffffff !important;
            cursor: text;
            z-index: 10;
            position: relative;
            pointer-events: auto;
            transition: all 0.2s ease;
        }
        select {
            cursor: pointer;
            appearance: auto;
            -webkit-appearance: auto;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%23FFD700' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
        input:focus, select:focus {
            border-color: #FFD700 !important;
            ring-color: #FFD700 !important;
            outline: none;
            box-shadow: 0 0 0 2px rgba(255, 215, 0, 0.2);
            transform: translateY(-1px);
        }
        input:hover, select:hover {
            border-color: #FFD700 !important;
            background: #222222 !important;
        }
        label {
            user-select: none;
        }
        .form-group {
            position: relative;
            z-index: 1;
            pointer-events: auto;
        }
        .table-row {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .table-row:hover {
            background: #1a1a1a;
        }
        .table-cell {
            position: relative;
            z-index: 1;
        }
        .clickable {
            cursor: pointer;
            transition: all 0.2s ease;
        }
        .clickable:hover {
            opacity: 0.8;
        }
        .btn-primary {
            background: linear-gradient(45deg, #FFD700, #FFA500) !important;
            color: #000000 !important;
            border: none !important;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .btn-primary:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(255, 215, 0, 0.3);
        }
        .btn-secondary {
            background: #1a1a1a !important;
            color: #FFD700 !important;
            border: 1px solid #FFD700 !important;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        .btn-secondary:hover {
            background: #FFD700 !important;
            color: #000000 !important;
        }
        .nav-link {
            cursor: pointer;
            transition: all 0.2s ease;
            position: relative;
        }
        .nav-link:hover {
            color: #FFD700;
        }
        .nav-link.active::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 100%;
            height: 2px;
            background: linear-gradient(45deg, #FFD700, #FFA500);
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        .loading-pulse {
            animation: pulse 1.5s cubic-bezier(0.4, 0, 0.6, 1) infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-spin {
            animation: spin 1s linear infinite;
        }
        
        .loading-skeleton {
            background: linear-gradient(
                90deg,
                #1a1a1a 25%,
                #222222 50%,
                #1a1a1a 75%
            );
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }
        
        @keyframes loading {
            to {
                background-position: -200% 0;
            }
        }
    </style>
</head>
<body class="bg-black">
    <div id="app" v-cloak>
        <!-- Navigation -->
        <nav class="bg-[#111111] border-b border-[#222222]">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
                <div class="flex justify-between h-16">
                    <div class="flex">
                        <div class="flex-shrink-0 flex items-center">
                            <span class="text-2xl font-bold bg-gradient-to-r from-yellow-500 to-orange-500 bg-clip-text text-transparent clickable" @click="currentView = 'test'">Blazee</span>
                        </div>
                        <div class="hidden sm:ml-6 sm:flex sm:space-x-8">
                            <a @click="currentView = 'test'" 
                               :class="[currentView === 'test' ? 'nav-link active border-yellow-500 text-white' : 'nav-link border-transparent text-gray-400 hover:text-gray-300', 'inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium']">
                                Teste de Envio
                            </a>
                            <a @click="currentView = 'schedule'"
                               :class="[currentView === 'schedule' ? 'nav-link active border-yellow-500 text-white' : 'nav-link border-transparent text-gray-400 hover:text-gray-300', 'inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium']">
                                Agendar Envio
                            </a>
                            <a @click="currentView = 'dashboard'"
                               :class="[currentView === 'dashboard' ? 'nav-link active border-yellow-500 text-white' : 'nav-link border-transparent text-gray-400 hover:text-gray-300', 'inline-flex items-center px-1 pt-1 border-b-2 text-sm font-medium']">
                                Dashboard
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto py-6 sm:px-6 lg:px-8">
            <!-- Test Email View -->
            <div v-if="currentView === 'test'" class="gradient-border">
                <div class="card p-6 rounded-lg">
                    <h3 class="text-lg leading-6 font-medium text-white mb-4">Enviar Email de Teste</h3>
                    <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                        <div class="sm:col-span-3">
                            <label class="block text-sm font-medium text-gray-300">Template</label>
                            <select v-model="testForm.template" class="mt-1 block w-full pl-3 pr-10 py-2 text-base rounded-md">
                                <option v-for="template in templates" :value="template">{{ template }}</option>
                            </select>
                        </div>

                        <div class="sm:col-span-3">
                            <label class="block text-sm font-medium text-gray-300">Email de Teste</label>
                            <div class="mt-1">
                                <input type="email" v-model="testForm.email" class="shadow-sm block w-full sm:text-sm rounded-md">
                            </div>
                        </div>

                        <div class="sm:col-span-3">
                            <label class="block text-sm font-medium text-gray-300">Nome</label>
                            <div class="mt-1">
                                <input type="text" v-model="testForm.name" class="shadow-sm block w-full sm:text-sm rounded-md">
                            </div>
                        </div>

                        <div class="sm:col-span-6">
                            <label class="block text-sm font-medium text-gray-300">Assunto</label>
                            <div class="mt-1">
                                <input type="text" v-model="testForm.subject" class="shadow-sm block w-full sm:text-sm rounded-md">
                            </div>
                        </div>

                        <div class="sm:col-span-6">
                            <label class="block text-sm font-medium text-gray-300">Preview</label>
                            <div class="mt-1">
                                <input type="text" v-model="testForm.preview" class="shadow-sm block w-full sm:text-sm rounded-md">
                            </div>
                        </div>

                        <div class="sm:col-span-6">
                            <div class="relative flex items-start">
                                <div class="flex items-center h-5">
                                    <input type="checkbox" v-model="testForm.schedule" class="focus:ring-yellow-500 h-4 w-4 text-yellow-600 border-gray-700 rounded bg-[#1a1a1a]">
                                </div>
                                <div class="ml-3 text-sm">
                                    <label class="font-medium text-gray-300">Agendar envio</label>
                                </div>
                            </div>
                        </div>

                        <template v-if="testForm.schedule">
                            <div class="sm:col-span-3">
                                <label class="block text-sm font-medium text-gray-300">Data de Envio</label>
                                <div class="mt-1">
                                    <input type="date" v-model="testForm.date" class="shadow-sm block w-full sm:text-sm rounded-md">
                                </div>
                            </div>

                            <div class="sm:col-span-3">
                                <label class="block text-sm font-medium text-gray-300">Hora de Envio</label>
                                <div class="mt-1">
                                    <input type="time" v-model="testForm.time" class="shadow-sm block w-full sm:text-sm rounded-md">
                                </div>
                            </div>
                        </template>
                    </div>

                    <div class="mt-6">
                        <button @click="sendTestEmail" class="btn-primary inline-flex items-center px-4 py-2 text-sm font-medium rounded-md shadow-sm">
                            {{ testForm.schedule ? 'Agendar Email de Teste' : 'Enviar Email de Teste' }}
                        </button>
                    </div>
                </div>
            </div>

            <!-- Schedule View -->
            <div v-if="currentView === 'schedule'" class="space-y-6">
                <!-- Formulário de Agendamento -->
                <div class="gradient-border">
                    <div class="card p-6 rounded-lg">
                        <h3 class="text-lg leading-6 font-medium text-white">Agendar Envio em Massa</h3>
                        <div class="mt-6 grid grid-cols-1 gap-y-6 gap-x-4 sm:grid-cols-6">
                            <!-- Lista de Emails -->
                            <div class="sm:col-span-6">
                                <label class="block text-sm font-medium text-gray-300">Lista de Emails</label>
                                <div class="mt-1 relative">
                                    <!-- Loading state -->
                                    <div v-if="isLoadingLists" class="absolute inset-y-0 right-0 pr-8 flex items-center pointer-events-none">
                                        <svg class="animate-spin h-5 w-5 text-yellow-500" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                            <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                            <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                        </svg>
                                    </div>
                                    
                                    <select v-model="scheduleForm.selectedList" 
                                            class="mt-1 block w-full pl-3 pr-10 py-2 text-base rounded-md"
                                            :class="{
                                                'border-yellow-500': scheduleForm.selectedList,
                                                'opacity-75': isLoadingLists
                                            }"
                                            :disabled="isLoadingLists">
                                        <option value="" disabled>{{ isLoadingLists ? 'Carregando listas...' : 'Selecione uma lista' }}</option>
                                        <option v-for="list in lists" 
                                                :key="list.name" 
                                                :value="list"
                                                :title="`${list.count} emails - Modificado em ${new Date(list.modified).toLocaleString('pt-BR')}`">
                                            {{ list.name }} ({{ list.count }} emails)
                                        </option>
                                    </select>
                                    
                                    <div v-if="scheduleForm.selectedList" class="mt-2 flex items-center justify-between">
                                        <p class="text-sm text-gray-400">
                                            Última modificação: {{ new Date(scheduleForm.selectedList.modified).toLocaleString('pt-BR') }}
                                        </p>
                                        <span class="text-sm text-yellow-500">
                                            Lista selecionada ✓
                                        </span>
                                    </div>
                                    
                                    <div v-if="scheduleForm.selectedList" class="mt-4">
                                        <button @click="loadPreview(scheduleForm.selectedList.name)" 
                                                class="text-sm text-yellow-500 hover:text-yellow-400 focus:outline-none"
                                                :disabled="isLoadingPreview">
                                            <span v-if="!isLoadingPreview">Ver preview da lista</span>
                                            <span v-else class="flex items-center">
                                                <svg class="animate-spin -ml-1 mr-2 h-4 w-4" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
                                                    <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
                                                    <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"></path>
                                                </svg>
                                                Carregando preview...
                                            </span>
                                        </button>
                                        
                                        <!-- Loading skeleton for preview -->
                                        <div v-if="isLoadingPreview" class="mt-2">
                                            <div class="h-4 w-3/4 bg-[#1a1a1a] rounded loading-skeleton mb-2"></div>
                                            <div class="space-y-2">
                                                <div v-for="i in 3" :key="i" class="h-4 w-full bg-[#1a1a1a] rounded loading-skeleton"></div>
                                            </div>
                                        </div>
                                        
                                        <!-- Actual preview data -->
                                        <div v-if="previewData && !isLoadingPreview" class="mt-2">
                                            <p class="text-sm font-medium text-gray-300 mb-2">
                                                Preview dos primeiros registros (total: {{ previewData.total_rows }} emails):
                                            </p>
                                            <div class="bg-[#1a1a1a] rounded-md p-2 text-sm text-gray-400">
                                                <div v-for="(row, index) in previewData.preview" :key="index" class="mb-1">
                                                    {{ row.EMAIL }} - {{ row.NOME }}
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="sm:col-span-3">
                                <label class="block text-sm font-medium text-gray-300">Template</label>
                                <select v-model="scheduleForm.template" class="mt-1 block w-full pl-3 pr-10 py-2 text-base rounded-md">
                                    <option value="">Selecione um template</option>
                                    <option v-for="template in templates" :value="template">{{ template }}</option>
                                </select>
                            </div>

                            <div class="sm:col-span-3">
                                <label class="block text-sm font-medium text-gray-300">Data de Envio</label>
                                <div class="mt-1">
                                    <input type="date" v-model="scheduleForm.date" class="shadow-sm block w-full sm:text-sm rounded-md">
                                </div>
                            </div>

                            <div class="sm:col-span-3">
                                <label class="block text-sm font-medium text-gray-300">Hora de Envio</label>
                                <div class="mt-1">
                                    <input type="time" v-model="scheduleForm.time" class="shadow-sm block w-full sm:text-sm rounded-md">
                                </div>
                            </div>

                            <div class="sm:col-span-6">
                                <label class="block text-sm font-medium text-gray-300">Assunto</label>
                                <div class="mt-1">
                                    <input type="text" v-model="scheduleForm.subject" class="shadow-sm block w-full sm:text-sm rounded-md">
                                </div>
                            </div>

                            <div class="sm:col-span-6">
                                <label class="block text-sm font-medium text-gray-300">Preview</label>
                                <div class="mt-1">
                                    <input type="text" v-model="scheduleForm.preview" class="shadow-sm block w-full sm:text-sm rounded-md">
                                </div>
                            </div>
                        </div>

                        <div class="mt-6 flex items-center justify-between">
                            <div>
                                <button @click="scheduleEmails" 
                                        :disabled="!isScheduleFormValid"
                                        :class="{
                                            'opacity-50 cursor-not-allowed': !isScheduleFormValid,
                                            'hover:transform hover:-translate-y-1': isScheduleFormValid
                                        }"
                                        class="btn-primary inline-flex items-center px-4 py-2 text-sm font-medium rounded-md shadow-sm">
                                    <span v-if="isScheduleFormValid">Agendar Envio</span>
                                    <span v-else class="flex items-center">
                                        <svg class="w-4 h-4 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 15v2m0 0v2m0-2h2m-2 0H8m13 0a9 9 0 11-18 0 9 9 0 0118 0z" />
                                        </svg>
                                        Preencha todos os campos
                                    </span>
                                </button>
                            </div>
                            <div v-if="scheduleForm.selectedList" class="text-sm text-gray-400">
                                Total de emails: {{ scheduleForm.selectedList.count }}
                            </div>
                        </div>

                        <!-- Feedback de campos obrigatórios -->
                        <div v-if="!isScheduleFormValid" class="mt-4">
                            <p class="text-sm text-yellow-500">Campos obrigatórios:</p>
                            <ul class="mt-2 text-sm text-gray-400 space-y-1">
                                <li v-if="!scheduleForm.selectedList" class="flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    Selecione uma lista de emails
                                </li>
                                <li v-if="!scheduleForm.template" class="flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    Selecione um template
                                </li>
                                <li v-if="!scheduleForm.date || !scheduleForm.time" class="flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    Defina a data e hora do envio
                                </li>
                                <li v-if="!scheduleForm.subject" class="flex items-center">
                                    <svg class="w-4 h-4 mr-2 text-yellow-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                    </svg>
                                    Digite o assunto do email
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>

                <!-- Lista de Agendamentos -->
                <div class="gradient-border">
                    <div class="card p-6 rounded-lg">
                        <h3 class="text-lg leading-6 font-medium text-white mb-4">Agendamentos</h3>
                        <div class="overflow-x-auto">
                            <table class="min-w-full divide-y divide-gray-800">
                                <thead>
                                    <tr>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Data/Hora</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Template</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Assunto</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Status</th>
                                        <th class="px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider">Ações</th>
                                    </tr>
                                </thead>
                                <tbody class="divide-y divide-gray-800">
                                    <tr v-for="schedule in schedules" :key="schedule.id" class="hover:bg-[#1a1a1a]">
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                            {{ formatDateTime(schedule.datetime) }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                            {{ schedule.template }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-300">
                                            {{ schedule.subject }}
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap">
                                            <span :class="getStatusBadgeClass(schedule.status)" class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full">
                                                {{ getStatusText(schedule.status) }}
                                            </span>
                                        </td>
                                        <td class="px-6 py-4 whitespace-nowrap text-sm">
                                            <button v-if="schedule.status === 'pendente'" @click="cancelSchedule(schedule.id)" 
                                                    class="btn-secondary px-3 py-1 rounded-lg">
                                                Cancelar
                                            </button>
                                        </td>
                                    </tr>
                                    <tr v-if="schedules.length === 0">
                                        <td colspan="5" class="px-6 py-4 text-center text-sm text-gray-400">
                                            Nenhum agendamento encontrado
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Dashboard View -->
            <iframe v-if="currentView === 'dashboard'" src="/dashboard.html" class="w-full h-screen border-0"></iframe>
        </main>

        <!-- Notification -->
        <div v-if="notification.show" class="fixed bottom-0 right-0 m-6">
            <div class="gradient-border">
                <div :class="['card rounded-lg p-4', notification.type === 'success' ? 'border-green-500' : 'border-red-500']">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <svg v-if="notification.type === 'success'" class="h-5 w-5 text-green-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd" />
                            </svg>
                            <svg v-else class="h-5 w-5 text-red-500" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 20 20" fill="currentColor">
                                <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zM8.707 7.293a1 1 0 00-1.414 1.414L8.586 10l-1.293 1.293a1 1 0 101.414 1.414L10 11.414l1.293 1.293a1 1 0 001.414-1.414L11.414 10l1.293-1.293a1 1 0 00-1.414-1.414L10 8.586 8.707 7.293z" clip-rule="evenodd" />
                            </svg>
                        </div>
                        <div class="ml-3">
                            <p :class="['text-sm font-medium', notification.type === 'success' ? 'text-green-400' : 'text-red-400']">
                                {{ notification.message }}
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue

        createApp({
            setup() {
                const currentView = ref('test')
                const templates = ref([])
                const lists = ref([])
                const notification = ref({ show: false, message: '', type: 'success' })
                const schedules = ref([])
                const previewData = ref(null)
                const isLoadingLists = ref(false)
                const isLoadingPreview = ref(false)

                const testForm = ref({
                    template: '',
                    email: 'brunnovert98@gmail.com',
                    name: 'Brunno',
                    subject: '',
                    preview: '',
                    schedule: false,
                    date: '',
                    time: ''
                })

                const scheduleForm = ref({
                    selectedList: null,
                    template: '',
                    date: '',
                    time: '',
                    subject: '',
                    preview: ''
                })

                // Computed property para validar o formulário
                const isScheduleFormValid = computed(() => {
                    const isValid = scheduleForm.value.selectedList &&
                           scheduleForm.value.template &&
                           scheduleForm.value.date &&
                           scheduleForm.value.time &&
                           scheduleForm.value.subject
                    
                    // Log de validação
                    if (!isValid) {
                        const missing = []
                        if (!scheduleForm.value.selectedList) missing.push('lista')
                        if (!scheduleForm.value.template) missing.push('template')
                        if (!scheduleForm.value.date) missing.push('data')
                        if (!scheduleForm.value.time) missing.push('hora')
                        if (!scheduleForm.value.subject) missing.push('assunto')
                        console.log('Formulário inválido. Campos faltantes:', missing.join(', '))
                    }
                    
                    return isValid
                })

                // Carrega preview de uma lista
                async function loadPreview(listName) {
                    try {
                        previewData.value = null
                        isLoadingPreview.value = true
                        const response = await fetch(`/api/preview_list/${listName}`)
                        const data = await response.json()
                        if (data.status === 'success') {
                            previewData.value = data
                        } else {
                            showNotification('Erro ao carregar preview: ' + data.message, 'error')
                        }
                    } catch (error) {
                        console.error('Erro ao carregar preview:', error)
                        showNotification('Erro ao carregar preview', 'error')
                    } finally {
                        isLoadingPreview.value = false
                    }
                }

                // Carrega a lista de templates e listas de email
                async function loadData() {
                    try {
                        console.log('=== Atualizando dados ===')
                        isLoadingLists.value = true
                        
                        // Carrega templates
                        console.log('Carregando templates...')
                        const templatesResponse = await fetch('/list_templates')
                        templates.value = await templatesResponse.json()
                        console.log('Templates carregados:', templates.value)

                        // Carrega listas de email
                        console.log('Carregando listas de email...')
                        const listsResponse = await fetch('/api/lists')
                        const listsData = await listsResponse.json()
                        if (listsData.status === 'success') {
                            lists.value = listsData.data
                            console.log('Listas carregadas:', lists.value)
                        } else {
                            console.error('Erro ao carregar listas:', listsData.message)
                            showNotification('Erro ao carregar listas de email', 'error')
                        }

                        // Carrega agendamentos
                        console.log('Carregando agendamentos...')
                        const schedulesResponse = await fetch('/schedules')
                        schedules.value = await schedulesResponse.json()
                        console.log('Agendamentos carregados:', schedules.value)

                    } catch (error) {
                        console.error('Erro ao carregar dados:', error)
                        showNotification('Erro ao carregar dados', 'error')
                    } finally {
                        isLoadingLists.value = false
                        console.log('=== Atualização concluída ===')
                    }
                }

                // Carrega os dados iniciais
                loadData()
                // Atualiza os dados a cada 30 segundos
                setInterval(loadData, 30000)

                // Envia ou agenda email de teste
                async function sendTestEmail() {
                    try {
                        const endpoint = testForm.value.schedule ? '/schedule_test' : '/send_test'
                        const data = {
                            ...testForm.value,
                            datetime: testForm.value.schedule ? 
                                `${testForm.value.date} ${testForm.value.time}:00` : null
                        }

                        const response = await fetch(endpoint, {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data)
                        })
                        
                        const result = await response.json()
                        if (result.success) {
                            showNotification(
                                testForm.value.schedule ? 
                                'Email de teste agendado com sucesso!' : 
                                'Email de teste enviado com sucesso!', 
                                'success'
                            )
                            if (testForm.value.schedule) {
                                loadData()
                            }
                        } else {
                            showNotification(result.error || 'Erro ao processar email', 'error')
                        }
                    } catch (error) {
                        showNotification('Erro ao processar email', 'error')
                    }
                }

                // Agenda envio em massa
                async function scheduleEmails() {
                    try {
                        if (!scheduleForm.value.selectedList) {
                            showNotification('Selecione uma lista de emails', 'error')
                            return
                        }

                        console.log('=== Iniciando agendamento de envio em massa ===')
                        console.log('Lista selecionada:', scheduleForm.value.selectedList)
                        console.log('Template:', scheduleForm.value.template)
                        console.log('Data/Hora:', `${scheduleForm.value.date} ${scheduleForm.value.time}:00`)

                        const datetime = `${scheduleForm.value.date} ${scheduleForm.value.time}:00`
                        const data = {
                            ...scheduleForm.value,
                            list_name: scheduleForm.value.selectedList.name,
                            datetime
                        }

                        console.log('Enviando requisição de agendamento:', data)
                        const response = await fetch('/api/schedule', {
                            method: 'POST',
                            headers: {
                                'Content-Type': 'application/json',
                            },
                            body: JSON.stringify(data)
                        })
                        
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`)
                        }
                        
                        const result = await response.json()
                        console.log('Resposta do servidor:', result)

                        if (result.status === 'success' && result.schedule) {
                            console.log('Agendamento criado com sucesso:', result.schedule)
                            showNotification(`Envio agendado com sucesso! ${result.schedule.total_emails} emails serão enviados.`, 'success')
                            
                            // Limpa o formulário
                            scheduleForm.value = {
                                selectedList: null,
                                template: '',
                                date: '',
                                time: '',
                                subject: '',
                                preview: ''
                            }
                            
                            // Atualiza a lista de agendamentos
                            loadData()
                        } else {
                            const errorMessage = result.message || 'Erro desconhecido ao agendar envio'
                            console.error('Erro ao agendar envio:', errorMessage)
                            showNotification(errorMessage, 'error')
                        }
                    } catch (error) {
                        console.error('Erro crítico ao agendar envio:', error)
                        showNotification(`Erro ao agendar envio: ${error.message}`, 'error')
                    }
                }

                // Cancela um agendamento
                async function cancelSchedule(id) {
                    try {
                        const response = await fetch(`/cancel_schedule/${id}`, {
                            method: 'POST'
                        })
                        
                        const result = await response.json()
                        if (result.success) {
                            showNotification('Agendamento cancelado com sucesso!', 'success')
                            loadData()
                        } else {
                            showNotification(result.error || 'Erro ao cancelar agendamento', 'error')
                        }
                    } catch (error) {
                        showNotification('Erro ao cancelar agendamento', 'error')
                    }
                }

                function showNotification(message, type = 'success') {
                    notification.value = { show: true, message, type }
                    setTimeout(() => {
                        notification.value.show = false
                    }, 5000)
                }

                function getStatusBadgeClass(status) {
                    const classes = {
                        'pendente': 'bg-yellow-100 text-yellow-800',
                        'enviando': 'bg-blue-100 text-blue-800',
                        'concluido': 'bg-green-100 text-green-800',
                        'erro': 'bg-red-100 text-red-800',
                        'cancelado': 'bg-gray-100 text-gray-800'
                    }
                    return classes[status] || 'bg-gray-100 text-gray-800'
                }

                function getStatusText(status) {
                    const texts = {
                        'pendente': 'Pendente',
                        'enviando': 'Enviando',
                        'concluido': 'Concluído',
                        'erro': 'Erro',
                        'cancelado': 'Cancelado'
                    }
                    return texts[status] || status
                }

                return {
                    currentView,
                    templates,
                    lists,
                    schedules,
                    testForm,
                    scheduleForm,
                    notification,
                    previewData,
                    isLoadingLists,
                    isLoadingPreview,
                    isScheduleFormValid,
                    sendTestEmail,
                    scheduleEmails,
                    cancelSchedule,
                    getStatusBadgeClass,
                    getStatusText,
                    loadPreview
                }
            }
        }).mount('#app')
    </script>
</body>
</html> 